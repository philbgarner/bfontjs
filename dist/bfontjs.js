!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.bfontjs=t():e.bfontjs=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{DrawText:()=>n,Generate437:()=>a,LoadFromJSON:()=>o});let r=null;function a(e){var t;(t=__dirname+"/fonts/Codepage-437.png",new Promise(((e,r)=>{try{let r=0,n=0,o=9,f=16,i={},d=(a=t,Buffer.from(fs.readFileSync(a)).toString("base64"));for(let e=0;e<256;e++)i[String.fromCharCode(e)]={x:r,y:n,w:o,h:f},r+=o,r>=288&&(r=0,n+=f),n>=128&&(n=0);e({codepage:i,imagedata:d})}catch(e){r(e)}var a}))).then((t=>{fs.writeFileSync(e,JSON.stringify(t))}))}function n(e,t,a,n,o,f){let i=t.image.width;r||(r=document.createElement("canvas"));let d=r.getContext("2d");d.clearRect(0,0,i,i);let g=0;for(let e in o){var l=t.codepage[o[e]];if(!l)return void console.log("Error finding value in codepage for",o[e],`(${o[e].charCodeAt(0)})`);d.drawImage(t.image,l.x,l.y,l.w,l.h,g,0,l.w,l.h),g+=l.w}var c,p=d.getImageData(0,0,g-l.w,l.h),s=p.data;let m=function(e){7===e.length?e+="ff":8===e.length&&(e+="0");var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)}:null}(f);for(c=0;c<s.length;c+=4)s[c]>0&&(s[c]=m.r,s[c+1]=m.g,s[c+2]=m.b,s[c+3]=m.a);d.clearRect(0,0,i,i),d.putImageData(p,0,0),e.drawImage(r,0,0,o.length*l.w,l.h,a,n,o.length*l.w,l.h)}function o(e){return new Promise(((t,r)=>{try{"string"==typeof e&&(e=JSON.parse(e)),e.image=new Image,e.image.src="data:image/png;base64,"+e.imagedata,t(e)}catch(e){r(e)}}))}return t})()));